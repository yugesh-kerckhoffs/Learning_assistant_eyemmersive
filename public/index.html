<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="favicon.png" />
    <title>Friendly Learning Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- Floating Notification Banner -->
    <div id="floatingBanner" class="floating-banner">
      <div class="banner-content">
        <span class="banner-icon">ğŸ’¡</span>
        <span class="banner-text" id="bannerText"></span>
        <button
          class="banner-close"
          onclick="closeBanner()"
          aria-label="Close banner"
        >
          x
        </button>
      </div>
    </div>

    <!-- Authentication Modal -->
    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal" style="display: none">
      <div class="auth-content">
        <img src="logo.png" alt="App Logo" class="logo" />
        <h2>ğŸŒŸ Welcome! ğŸŒŸ</h2>
        <p>Please choose how you'd like to proceed:</p>

        <div class="auth-buttons" id="authMainButtons">
          <button class="auth-btn guest-btn" onclick="loginAsGuest()">
            ğŸ‘¤ Continue as Guest
          </button>
          <button class="auth-btn signin-btn" onclick="showSignIn()">
            ğŸ” Sign In
          </button>
          <button class="auth-btn signup-btn" onclick="showSignUp()">
            âœ¨ Sign Up
          </button>
          <button class="auth-btn admin-btn" onclick="showAdminLogin()">
            ğŸ”‘ Admin Login
          </button>
        </div>

        <div id="adminLoginForm" style="display: none">
          <div class="password-input-wrapper">
            <input
              type="password"
              id="secretKeyInput"
              class="secret-key-input"
              placeholder="Enter Admin Secret Key ğŸ”‘"
              onkeypress="handleAdminKeyPress(event)"
            />
            <button
              type="button"
              class="password-toggle-btn"
              onclick="togglePasswordVisibility('secretKeyInput', this)"
              tabindex="-1"
            >
              ğŸ‘ï¸â€ğŸ—¨ï¸
            </button>
          </div>
          <button class="auth-btn verify-btn" onclick="verifyAdminKey()">
            âœ“ Verify
          </button>
          <button class="auth-btn back-btn" onclick="hideAdminLogin()">
            â† Back
          </button>
          <p id="authError" class="auth-error"></p>
        </div>
        <!-- Sign In Form -->
        <div id="signInForm" style="display: none">
          <input
            type="email"
            id="signInEmail"
            class="secret-key-input"
            placeholder="Enter your email ğŸ“§"
            style="margin-top: 0"
          />
          <div class="password-input-wrapper">
            <input
              type="password"
              id="signInPassword"
              class="secret-key-input"
              placeholder="Enter your password ğŸ”’"
            />
            <button
              type="button"
              class="password-toggle-btn"
              onclick="togglePasswordVisibility('signInPassword', this)"
              tabindex="-1"
            >
              ğŸ‘ï¸â€ğŸ—¨ï¸
            </button>
          </div>
          <p style="text-align: center; margin: 10px 0">
            <a
              href="#"
              onclick="showForgotPassword(); return false;"
              style="color: #4fc3f7; text-decoration: none; font-size: 0.9em"
              >Forgot Password? ğŸ”‘</a
            >
          </p>
          <button class="auth-btn verify-btn" onclick="handleSignIn()">
            âœ“ Sign In
          </button>
          <button class="auth-btn back-btn" onclick="hideSignIn()">
            â† Back
          </button>
          <p id="signInError" class="auth-error"></p>
        </div>
        <!-- Forgot Password Form -->
        <div id="forgotPasswordForm" style="display: none">
          <h3 style="text-align: center; color: #4fc3f7; margin-bottom: 15px">
            Reset Password
          </h3>
          <p
            style="
              text-align: center;
              color: rgba(255, 255, 255, 0.8);
              font-size: 0.9em;
              margin-bottom: 20px;
            "
          >
            Enter your email and we'll send you a password reset link
          </p>
          <input
            type="email"
            id="forgotPasswordEmail"
            class="secret-key-input"
            placeholder="Enter your email ğŸ“§"
            style="margin-top: 0"
          />
          <button class="auth-btn verify-btn" onclick="handleForgotPassword()">
            ğŸ“§ Send Reset Link
          </button>
          <button class="auth-btn back-btn" onclick="hideForgotPassword()">
            â† Back
          </button>
          <p id="forgotPasswordError" class="auth-error"></p>
          <p
            id="forgotPasswordSuccess"
            style="
              color: #66bb6a;
              text-align: center;
              margin-top: 10px;
              font-size: 0.9em;
            "
          ></p>
        </div>

        <!-- Sign Up Form -->
        <div id="signUpForm" style="display: none">
          <input
            type="text"
            id="signUpName"
            class="secret-key-input"
            placeholder="Enter your name ğŸ˜Š"
            style="margin-top: 0"
          />
          <input
            type="email"
            id="signUpEmail"
            class="secret-key-input"
            placeholder="Enter your email ğŸ“§"
          />
          <div class="password-input-wrapper">
            <input
              type="password"
              id="signUpPassword"
              class="secret-key-input"
              placeholder="Create a password ğŸ”’"
            />
            <button
              type="button"
              class="password-toggle-btn"
              onclick="togglePasswordVisibility('signUpPassword', this)"
              tabindex="-1"
            >
              ğŸ‘ï¸â€ğŸ—¨ï¸
            </button>
          </div>
          <div class="password-input-wrapper">
            <input
              type="password"
              id="signUpConfirmPassword"
              class="secret-key-input"
              placeholder="Confirm password ğŸ”’"
            />
            <button
              type="button"
              class="password-toggle-btn"
              onclick="togglePasswordVisibility('signUpConfirmPassword', this)"
              tabindex="-1"
            >
              ğŸ‘ï¸â€ğŸ—¨ï¸
            </button>
          </div>
          <button class="auth-btn verify-btn" onclick="handleSignUp()">
            âœ“ Sign Up
          </button>
          <button class="auth-btn back-btn" onclick="hideSignUp()">
            â† Back
          </button>
          <p id="signUpError" class="auth-error"></p>
        </div>

        <p class="auth-note">
          <strong>Guest Access:</strong> Try the app without an account<br />
          <strong>Sign In/Up:</strong> Save your progress and chat history ğŸ’¾<br />
          <strong>Admin Access:</strong> All features including video generation
          ğŸ¬
        </p>
      </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="resetPasswordModal" class="auth-modal" style="display: none">
      <div class="auth-content">
        <img src="logo.png" alt="App Logo" class="logo" />
        <h2>ğŸ” Reset Password</h2>
        <p>Enter your new password below</p>

        <div class="password-input-wrapper">
          <input
            type="password"
            id="resetNewPassword"
            class="secret-key-input"
            placeholder="New Password ğŸ”’"
            style="margin-top: 0"
          />
          <button
            type="button"
            class="password-toggle-btn"
            onclick="togglePasswordVisibility('resetNewPassword', this)"
            tabindex="-1"
          >
            ğŸ‘ï¸â€ğŸ—¨ï¸
          </button>
        </div>
        <div class="password-input-wrapper">
          <input
            type="password"
            id="resetConfirmPassword"
            class="secret-key-input"
            placeholder="Confirm Password ğŸ”’"
          />
          <button
            type="button"
            class="password-toggle-btn"
            onclick="togglePasswordVisibility('resetConfirmPassword', this)"
            tabindex="-1"
          >
            ğŸ‘ï¸â€ğŸ—¨ï¸
          </button>
        </div>
        <button class="auth-btn verify-btn" onclick="handlePasswordReset()">
          âœ“ Reset Password
        </button>
        <p id="resetPasswordError" class="auth-error"></p>
        <p
          id="resetPasswordSuccess"
          style="
            color: #66bb6a;
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
          "
        ></p>
      </div>
    </div>
    <div class="container">
      <div class="header">
        <img src="logo.png" alt="App Logo" class="logo" />
        <h1 class="title">ğŸŒŸ Your Learning Assistant ğŸŒŸ</h1>
        <p class="subtitle">Friendly Chat with Tom & Jerry!</p>
        <div class="character-container">
          <div
            class="character tom"
            onclick="speakAs('tom')"
            title="Click Tom!"
            tabindex="0"
          >
            ğŸ±
          </div>
          <div
            class="character jerry"
            onclick="speakAs('jerry')"
            title="Click Jerry!"
            tabindex="0"
          >
            ğŸ­
          </div>
        </div>
        <div class="level-progress-wrapper">
          <div class="level-badge">Level <span id="currentLevel">1</span></div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
          </div>
        </div>
      </div>

      <div class="settings-panel">
        <button class="control-btn-1" onclick="changeTheme()">ğŸ¨ Theme</button>
        <a href="https://" target="_blank">
          <button class="control-btn-3">ğŸ’› Donate</button>
        </a>
        <button class="control-btn-2" onclick="logout()" id="logoutButton">
          ğŸšª Logout
        </button>
      </div>

      <div class="main-content">
        <div class="sidebar">
          <h3>ğŸ“š Learning Activities</h3>
          <div class="visual-schedule">
            <div
              class="activity-card-main"
              onclick="viewSavedMedia()"
              tabindex="0"
            >
              <h4>ğŸ–¼ï¸ My Gallery</h4>
              <p>View saved images & videos</p>
            </div>
            <div
              class="activity-card"
              onclick="enterGeneralMode()"
              tabindex="0"
            >
              <h4>ğŸ’¬ General Chat</h4>
              <p>Ask about anything</p>
            </div>
            <div
              class="activity-card"
              onclick="enterColorsShapesMode()"
              tabindex="0"
            >
              <h4>ğŸ¨ Colors & Shapes</h4>
              <p>Learn Colors & Shapes</p>
            </div>
            <div
              class="activity-card"
              onclick="enterFeelingsHelperMode()"
              tabindex="0"
            >
              <h4>ğŸ˜Š Feelings Helper</h4>
              <p>Share you feelings</p>
            </div>
          </div>
          <div
            class="activity-card"
            onclick="enterMemoryGameMode()"
            tabindex="0"
          >
            <h4>ğŸ® Memory Game</h4>
            <p>Play with Tom & Jerry!</p>
          </div>
          <div
            class="activity-card"
            onclick="enterCalmBreathingMode()"
            tabindex="0"
          >
            <h4>ğŸ« Calm Breathing</h4>
            <p>Relax with gentle sounds</p>
          </div>
          <div
            class="activity-card"
            onclick="enterSocialStoriesMode()"
            tabindex="0"
          >
            <h4>ğŸ“š Social Stories</h4>
            <p>Learn through visual stories</p>
          </div>
        </div>

        <div class="chat-area" id="chatArea">
          <div class="controls" id="controlsArea">
            <button class="control-btn" onclick="clearChat()">ğŸ—‘ï¸ Clear</button>
            <button class="control-btn" onclick="showHelp()">â“ Help</button>
            <button class="control-btn" onclick="celebrateProgress()">
              ğŸ‰ Celebrate
            </button>
            <button
              class="control-btn"
              onclick="toggleVoice()"
              id="voiceButton"
            >
              ğŸ”Š Voice
            </button>
            <div class="setting-item">
              <span>ğŸ”Š</span>
              <input
                type="range"
                class="volume-slider"
                min="0"
                max="100"
                value="50"
                id="volume"
                oninput="updateVolume()"
              />
            </div>
          </div>
          <div class="messages" id="messages"></div>
          <div class="input-area" id="inputArea">
            <input
              type="text"
              class="input-field"
              placeholder="Type your message here... ğŸŒŸ"
              id="messageInput"
              onkeypress="handleKeyPress(event)"
            />
            <button
              class="send-button"
              onclick="sendMessage()"
              tabindex="0"
              id="sendButton"
            >
              â¤
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="js/script.js"></script>
  </body>
</html>